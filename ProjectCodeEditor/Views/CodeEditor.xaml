<UserControl
    x:Class="ProjectCodeEditor.Views.CodeEditor"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="using:Microsoft.Toolkit.Uwp.UI.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:dataTransfer="using:Windows.ApplicationModel.DataTransfer"
    xmlns:editor="using:TextEditor.UI"
    xmlns:local="using:ProjectCodeEditor.Views"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:muxc="using:Microsoft.UI.Xaml.Controls"
    xmlns:services="using:ProjectCodeEditor.Services"
    d:DesignHeight="300"
    d:DesignWidth="400"
    Loaded="UserControl_Loaded"
    Unloaded="UserControl_Unloaded"
    mc:Ignorable="d">

    <UserControl.Resources>
        <SolidColorBrush x:Key="NavigationViewTopPaneBackground" Color="Transparent" />
        <MenuFlyout x:Key="EditorMenu" AreOpenCloseAnimationsEnabled="True">
            <MenuFlyoutSubItem x:Uid="FileSubItem">
                <MenuFlyoutItem IsEnabled="{x:Bind ViewModel.Saved, Mode=OneWay, Converter={StaticResource BooleanReverse}}">
                    <MenuFlyoutItem.Command>
                        <StandardUICommand
                            CanExecuteRequested="StandardUICommand_CanExecuteRequested"
                            ExecuteRequested="{x:Bind ViewModel.Save}"
                            Kind="Save" />
                    </MenuFlyoutItem.Command>
                </MenuFlyoutItem>
                <MenuFlyoutItem x:Uid="SaveAsItem" Click="{x:Bind ViewModel.SaveAs}">
                    <MenuFlyoutItem.Icon>
                        <FontIcon FontFamily="Segoe MDL2 Assets" Glyph="&#xEA35;" />
                    </MenuFlyoutItem.Icon>
                    <MenuFlyoutItem.KeyboardAccelerators>
                        <KeyboardAccelerator
                            Key="S"
                            IsEnabled="{x:Bind ViewModel.CanInteract, Mode=OneWay}"
                            Modifiers="Control, Shift" />
                    </MenuFlyoutItem.KeyboardAccelerators>
                </MenuFlyoutItem>
                <MenuFlyoutSubItem
                    x:Uid="ShareItem"
                    Icon="Share"
                    IsEnabled="{x:Bind dataTransfer:DataTransferManager.IsSupported()}">
                    <MenuFlyoutItem x:Uid="ShareAsFileItem" Click="{x:Bind ViewModel.ShareAsFile}" />
                    <MenuFlyoutItem x:Uid="ShareAsTextItem" Click="{x:Bind ViewModel.ShareAsText}" />
                    <MenuFlyoutItem
                        x:Uid="ShareAsSelectionItem"
                        Click="{x:Bind ViewModel.ShareAsSelection}"
                        IsEnabled="{x:Bind Editor.IsSelectionValid, Mode=OneWay}" />
                </MenuFlyoutSubItem>
                <MenuFlyoutItem>
                    <MenuFlyoutItem.Command>
                        <StandardUICommand Kind="Close" />
                    </MenuFlyoutItem.Command>
                </MenuFlyoutItem>
            </MenuFlyoutSubItem>
            <MenuFlyoutSubItem x:Uid="EditSubItem">
                <MenuFlyoutItem IsEnabled="{x:Bind ViewModel.CanUndo, Mode=OneWay}">
                    <MenuFlyoutItem.Command>
                        <StandardUICommand
                            CanExecuteRequested="StandardUICommand_CanExecuteRequested"
                            ExecuteRequested="Undo_Click"
                            Kind="Undo" />
                    </MenuFlyoutItem.Command>
                </MenuFlyoutItem>
                <MenuFlyoutItem IsEnabled="{x:Bind ViewModel.CanRedo, Mode=OneWay}">
                    <MenuFlyoutItem.Command>
                        <StandardUICommand
                            CanExecuteRequested="StandardUICommand_CanExecuteRequested"
                            ExecuteRequested="Redo_Click"
                            Kind="Redo" />
                    </MenuFlyoutItem.Command>
                </MenuFlyoutItem>
                <MenuFlyoutItem x:Uid="ClearHistoryItem" Click="{x:Bind ViewModel.ClearHistory}" />
                <MenuFlyoutSeparator />
                <MenuFlyoutItem
                    x:Uid="GoToLineItem"
                    Click="GoTo_Click"
                    Icon="Go">
                    <MenuFlyoutItem.KeyboardAccelerators>
                        <KeyboardAccelerator
                            Key="G"
                            IsEnabled="{x:Bind ViewModel.CanInteract, Mode=OneWay}"
                            Modifiers="Control" />
                    </MenuFlyoutItem.KeyboardAccelerators>
                </MenuFlyoutItem>
                <MenuFlyoutItem
                    x:Uid="FindItem"
                    Click="Find_Click"
                    Icon="Find">
                    <MenuFlyoutItem.KeyboardAccelerators>
                        <KeyboardAccelerator
                            Key="F"
                            IsEnabled="{x:Bind ViewModel.CanInteract, Mode=OneWay}"
                            Modifiers="Control" />
                    </MenuFlyoutItem.KeyboardAccelerators>
                </MenuFlyoutItem>
                <MenuFlyoutSeparator />
                <MenuFlyoutItem>
                    <MenuFlyoutItem.Command>
                        <StandardUICommand
                            CanExecuteRequested="StandardUICommand_CanExecuteRequested"
                            ExecuteRequested="{x:Bind Editor.SelectAll}"
                            Kind="SelectAll" />
                    </MenuFlyoutItem.Command>
                </MenuFlyoutItem>
                <MenuFlyoutItem
                    x:Uid="ClearSelectionItem"
                    Click="{x:Bind Editor.ClearSelection}"
                    Icon="ClearSelection"
                    IsEnabled="{x:Bind Editor.IsSelectionValid, Mode=OneWay}" />
            </MenuFlyoutSubItem>
        </MenuFlyout>
    </UserControl.Resources>

    <Grid>
        <ProgressRing
            Width="100"
            Height="100"
            IsActive="{x:Bind ViewModel.IsLoading, Mode=OneWay}" />
        <editor:SyntaxEditor
            x:Name="Editor"
            HorizontalAlignment="Stretch"
            VerticalAlignment="Stretch"
            ContextMenu="{StaticResource EditorMenu}"
            FontFamily="{x:Bind AppSettings.FontFamily, Mode=OneWay}"
            FontSize="{x:Bind AppSettings.FontSize, Mode=OneWay}"
            IsTabStop="False"
            SyntaxLanguage="{x:Bind ViewModel.CodeLanguage, Mode=OneWay}"
            TabSize="{x:Bind AppSettings.TabSize, Mode=OneWay}"
            Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource ReverseBoolToVisibility}}">
            <editor:SyntaxEditor.KeyboardAccelerators>
                <KeyboardAccelerator
                    Key="Escape"
                    Invoked="Editor_Escaped"
                    IsEnabled="{x:Bind ViewModel.CanInteract, Mode=OneWay}"
                    Modifiers="None" />
            </editor:SyntaxEditor.KeyboardAccelerators>
        </editor:SyntaxEditor>
    </Grid>
</UserControl>
