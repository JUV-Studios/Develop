<UserControl
    x:Class="ProjectCodeEditor.Views.CodeEditor"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:dataTransfer="using:Windows.ApplicationModel.DataTransfer"
    xmlns:editor="using:TextEditor.UI"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:root="using:ProjectCodeEditor"
    d:DesignHeight="300"
    d:DesignWidth="400"
    Loaded="UserControl_Loaded"
    Unloaded="UserControl_Unloaded"
    mc:Ignorable="d">

    <UserControl.Resources>
        <SolidColorBrush x:Key="NavigationViewTopPaneBackground" Color="Transparent" />
        <MenuFlyout x:Key="EditorMenu" AreOpenCloseAnimationsEnabled="True">
            <MenuFlyoutSubItem x:Uid="FileSubItem">
                <MenuFlyoutItem IsEnabled="{x:Bind ViewModel.Saved, Mode=OneWay, Converter={StaticResource BooleanReverse}}">
                    <MenuFlyoutItem.Command>
                        <StandardUICommand
                            CanExecuteRequested="StandardUICommand_CanExecuteRequested"
                            ExecuteRequested="{x:Bind ViewModel.Save}"
                            Kind="Save" />
                    </MenuFlyoutItem.Command>
                </MenuFlyoutItem>
                <MenuFlyoutItem x:Uid="SaveAsItem" Click="{x:Bind ViewModel.SaveAs}">
                    <MenuFlyoutItem.Icon>
                        <FontIcon FontFamily="Segoe MDL2 Assets" Glyph="&#xEA35;" />
                    </MenuFlyoutItem.Icon>
                    <MenuFlyoutItem.KeyboardAccelerators>
                        <KeyboardAccelerator
                            Key="S"
                            IsEnabled="{x:Bind ViewModel.Unloaded, Converter={StaticResource BooleanReverse}, Mode=OneWay}"
                            Modifiers="Control, Shift" />
                    </MenuFlyoutItem.KeyboardAccelerators>
                </MenuFlyoutItem>
                <MenuFlyoutSubItem
                    x:Uid="ShareItem"
                    Icon="Share"
                    IsEnabled="{x:Bind dataTransfer:DataTransferManager.IsSupported()}">
                    <MenuFlyoutItem x:Uid="ShareAsFileItem" Click="{x:Bind ViewModel.ShareAsFile}" />
                    <MenuFlyoutItem x:Uid="ShareAsTextItem" Click="{x:Bind ViewModel.ShareAsText}" />
                    <MenuFlyoutItem
                        x:Uid="ShareAsSelectionItem"
                        Click="{x:Bind ViewModel.ShareAsSelection}"
                        IsEnabled="{x:Bind Editor.IsSelectionValid, Mode=OneWay}" />
                </MenuFlyoutSubItem>
            </MenuFlyoutSubItem>
            <MenuFlyoutSubItem x:Uid="EditSubItem">
                <MenuFlyoutItem IsEnabled="{x:Bind ViewModel.CanUndo, Mode=OneWay}">
                    <MenuFlyoutItem.Command>
                        <StandardUICommand
                            CanExecuteRequested="StandardUICommand_CanExecuteRequested"
                            ExecuteRequested="{x:Bind ViewModel.Undo}"
                            Kind="Undo" />
                    </MenuFlyoutItem.Command>
                </MenuFlyoutItem>
                <MenuFlyoutItem IsEnabled="{x:Bind ViewModel.CanRedo, Mode=OneWay}">
                    <MenuFlyoutItem.Command>
                        <StandardUICommand
                            CanExecuteRequested="StandardUICommand_CanExecuteRequested"
                            ExecuteRequested="{x:Bind ViewModel.Redo}"
                            Kind="Redo" />
                    </MenuFlyoutItem.Command>
                </MenuFlyoutItem>
                <MenuFlyoutItem
                    x:Uid="ClearHistoryItem"
                    Click="{x:Bind ViewModel.ClearHistory}"
                    IsEnabled="{x:Bind ViewModel.CanClearHistory, Mode=OneWay}" />
                <MenuFlyoutSeparator />
                <MenuFlyoutItem
                    x:Uid="GoToLineItem"
                    Click="GoTo_Click"
                    Icon="Go">
                    <MenuFlyoutItem.KeyboardAccelerators>
                        <KeyboardAccelerator
                            Key="G"
                            IsEnabled="{x:Bind ViewModel.Unloaded, Converter={StaticResource BooleanReverse}, Mode=OneWay}"
                            Modifiers="Control" />
                    </MenuFlyoutItem.KeyboardAccelerators>
                </MenuFlyoutItem>
                <MenuFlyoutItem
                    x:Uid="FindItem"
                    Click="Find_Click"
                    Icon="Find">
                    <MenuFlyoutItem.KeyboardAccelerators>
                        <KeyboardAccelerator
                            Key="F"
                            IsEnabled="{x:Bind ViewModel.Unloaded, Converter={StaticResource BooleanReverse}, Mode=OneWay}"
                            Modifiers="Control" />
                    </MenuFlyoutItem.KeyboardAccelerators>
                </MenuFlyoutItem>
                <MenuFlyoutSeparator />
                <MenuFlyoutItem>
                    <MenuFlyoutItem.Command>
                        <StandardUICommand
                            CanExecuteRequested="StandardUICommand_CanExecuteRequested"
                            ExecuteRequested="{x:Bind Editor.SelectAll}"
                            Kind="SelectAll" />
                    </MenuFlyoutItem.Command>
                </MenuFlyoutItem>
                <MenuFlyoutItem
                    x:Uid="ClearSelectionItem"
                    Click="{x:Bind Editor.ClearSelection}"
                    Icon="ClearSelection"
                    IsEnabled="{x:Bind Editor.IsSelectionValid, Mode=OneWay}" />
            </MenuFlyoutSubItem>
        </MenuFlyout>
    </UserControl.Resources>

    <Grid>
        <Border
            x:Name="SplashScreen"
            HorizontalAlignment="Stretch"
            VerticalAlignment="Stretch"
            Background="{ThemeResource SystemAccentColor}"
            RequestedTheme="Dark"
            Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource BoolToVisibility}}">
            <StackPanel
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Spacing="8">
                <TextBlock
                    FontFamily="Segoe MDL2 Assets"
                    FontSize="{StaticResource TextStyleLargeFontSize}"
                    Text="&#xE130;" />
                <TextBlock Text="{x:Bind ViewModel.WorkingFile.Name}" TextAlignment="Center" />
                <ProgressRing Foreground="White" IsActive="{x:Bind ViewModel.IsLoading, Mode=OneWay}" />
            </StackPanel>
        </Border>
        <editor:SyntaxEditor
            x:Name="Editor"
            HorizontalAlignment="Stretch"
            VerticalAlignment="Stretch"
            ContextMenu="{StaticResource EditorMenu}"
            FontFamily="{x:Bind root:App.AppSettings.FontFamily, Mode=OneWay}"
            FontSize="{x:Bind root:App.AppSettings.FontSize, Mode=OneWay}"
            SyntaxLanguage="{x:Bind ViewModel.CodeLanguage, Mode=OneWay}"
            TabSize="{x:Bind root:App.AppSettings.TabSize, Mode=OneWay}"
            Text="{x:Bind ViewModel.UserContent, Mode=OneWay}"
            Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource ReverseBoolToVisibility}}">
            <editor:SyntaxEditor.KeyboardAccelerators>
                <KeyboardAccelerator
                    Key="Escape"
                    Invoked="Editor_Escaped"
                    IsEnabled="{x:Bind ViewModel.Unloaded, Converter={StaticResource BooleanReverse}, Mode=OneWay}"
                    Modifiers="None" />
            </editor:SyntaxEditor.KeyboardAccelerators>
        </editor:SyntaxEditor>
    </Grid>
</UserControl>
